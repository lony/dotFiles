---

sudo: required
language: objective-c
osx_image: xcode9.1

before_install:
  # Uninstall existing brew installation.
  - 'ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/uninstall)"'
  - rm -rf /usr/local/Caskroom
  - rm -rf /usr/local/Cellar
  - rm -rf /usr/local/Homebrew
  - rm -rf /usr/local/bin/brew

script:
  # Ansible - Test playbook syntax
  - 'ansible-playbook -i "localhost," -c local ansible/site.yml --syntax-check'

  # Run and test
  - "travis_wait 30 ./setup.sh"

  # # Test the playbook's idempotence.
  # - idempotence=$(mktemp)
  # - "ansible-playbook --extra-vars '{\"configure_sudoers\":\"false\"}' main.yml | tee -a ${idempotence}"
  # - >
  #   tail ${idempotence}
  #   | grep -q 'changed=0.*failed=0'
  #   && (echo 'Idempotence test: pass' && exit 0)
  #   || (echo 'Idempotence test: fail' && exit 1)
